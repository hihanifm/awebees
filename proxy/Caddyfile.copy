{
    # Global options
    # Log errors and info to caddy.log
    log {
        output file logs/caddy.log
        level INFO
    }
}

:8080 {
    # HTTP access logging - JSON format (can be parsed easily)
    log {
        output file logs/access.log
        format json
        level INFO
    }
    
    # Reverse proxy to target server
    # Forward all paths as-is - no modification
    # The API service/client is responsible for including /v1 in the path
    reverse_proxy https://api.openai.com:443 {
        # Enable streaming for AI responses (flush immediately)
        flush_interval -1
        
        # Set Host header to target server (required for Cloudflare/API servers)
        header_up Host api.openai.com
        
        # Preserve original scheme for proper forwarding
        header_up X-Forwarded-Proto {scheme}
        
        # Transport settings for better streaming
        transport http {
            dial_timeout 30s
            response_header_timeout 30s
        }
    }
}
